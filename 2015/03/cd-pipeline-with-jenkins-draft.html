<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Building a CD pipeline with Jenkins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/prettify.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Abel' rel='stylesheet' type='text/css'>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../">Sion's Blog</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../index.html">Home</a></li>
            <li><a href="../../about.html">About</a></li>
            <li><a href="../../feed.xml">Subscribe</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

	<div class="page-header">
		<h1>Building a CD pipeline with Jenkins</h1>
	</div>

	<p><em>24 March 2015</em></p>
	<p><em>Tags: </em>
		<a href="/blog/tags/jenkins.html">jenkins</a>
	</em>
		<a href="/blog/tags/continuous-delivery.html"> continuous delivery</a>
	</em>
		<a href="/blog/tags/gradle.html"> gradle</a>
	</em>
		<a href="/blog/tags/git.html"> git</a>
	</p>

	<p><div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The purpose of this post is to create a robust continuous delivery pipeline which allows us to perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build, Test and Deploy.</p>
</li>
<li>
<p>Rollback in the event of a failed deployment.</p>
</li>
<li>
<p>Support a hotfix style release.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In pure Continuous Delivery we wouldn&#8217;t typically support a hotfix route to production, but in reality we often find situations when features are in test longer than we anticipated, and so we need a new route to production. Ideally, we would simply develop a fix and push it into the pipeline for delivery to production.</p>
</div>
<div class="paragraph">
<p>Throughout this post I will try to stay true to the concepts defined by Jez Humble in the fantastic book <a href="http://www.amazon.com/dp/0321601912?tag=contindelive-20">Continuous Delivery</a>.</p>
</div>
<div class="paragraph">
<p>The tools I will use are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java</p>
</li>
<li>
<p>Gradle</p>
</li>
<li>
<p>Git</p>
</li>
<li>
<p>Jenkins</p>
<div class="ulist">
<ul>
<li>
<p>Git Plugin</p>
</li>
<li>
<p>Artifact Publisher</p>
</li>
<li>
<p>Copy Artifact Plugin</p>
</li>
<li>
<p>Env Inject</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>I&#8217;m going to assume you have some familiarity with Jenkins, and so I wont be discussing how to create a job and the more basic parts of Jenkins.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commit_stage">Commit Stage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this phase we need to validate our latest commit - it needs to be fast, lightweight and provide feedback within 10 minutes. Jez highlights that the Commit stage should have the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compile the code (if necessary).</p>
</li>
<li>
<p>Run a set of commit tests.</p>
</li>
<li>
<p>Create binaries for use by later stages.</p>
</li>
<li>
<p>Perform analysis of the code to check its health.</p>
</li>
<li>
<p>Prepare artifacts, such as test databases, for use by later stages.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_job_1_build_test">Job 1 - Build &amp; Test</h3>
<div class="paragraph">
<p>In this job we will perform a few actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pull from Git.</p>
</li>
<li>
<p>Build &amp; Test.</p>
</li>
<li>
<p>Archive the artifacts.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_how_to_do_it">How to do it..</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the Jenkins home screen, click <strong>New Item</strong> to create a new job.</p>
</li>
<li>
<p>Enter a Project Name. I like to use the gradle task name here <code>myProject_build</code>.</p>
</li>
<li>
<p>Select <strong>Git</strong> under <strong>Source Code Management</strong>. Provide your repo url, branch and then hit the <strong>Add</strong> button. Select <strong>Clean after checkout</strong> to ensure we have a clean repo every time.</p>
</li>
<li>
<p>For <strong>Build Triggers</strong> I used <strong>Poll SCM</strong>, but check out the improvement below for a better solution.</p>
</li>
<li>
<p>Under <strong>Build Environment</strong> check <strong>Inject environment variables to the build process</strong> and enter <code>SOURCE_BUILD_NUMBER=${build_number}</code> in the <strong>Properties Content</strong> text box.</p>
</li>
<li>
<p><strong>Add build step</strong>, choose <strong>Invoke Gradle script</strong>. Select <strong>Use Gradle Wrapper</strong>, check <strong>Make gradlew executable</strong>, and enter <code>build</code> in the <strong>Tasks</strong> box.</p>
</li>
<li>
<p><strong>Add post-build action</strong> select <strong>Archive the artifacts</strong>. Your <strong>Files to archive</strong> may be different in the event of a multi-module build, but I use <code>/build/<strong>*/</strong></code>.</p>
</li>
<li>
<p><strong>Add post-build action</strong> select <strong>Trigger parameterized build on other projects</strong>.
.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_how_it_works">How it works..</h4>
<div class="paragraph">
<p>This is our really simple fast build task. We simply check we can compile and run our unit tests. We produce some build artifacts and archive them for later use in the pipeline. We also pass through the git commit so we know we have the correct version of the build files to match the artifacts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improvements">Improvements:</h4>
<div class="paragraph">
<p>Ideally, we dont want to keep polling our repository for a change, we want to tell Jenkins when a change is made. Fortunately, Git allows us to do that using it&#8217;s hooks mechanic.</p>
</div>
<div class="paragraph">
<p>See <a href="http://kohsuke.org/2011/12/01/polling-must-die-triggering-jenkins-builds-from-a-git-hook/">Polling must die: triggering Jenkins builds from a git hook</a> by Kohsuke.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_job_2_integration_test">Job 2 - Integration Test</h3>

</div>
<div class="sect2">
<h3 id="_job_3_analysis">Job 3 - Analysis</h3>
<div class="paragraph">
<p>You may chose to do this in parallel</p>
</div>
</div>
</div>
</div></p>

	<hr>

	<!-- **** DISQUS **** -->
	<div id="disqus_thread"></div>
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'willis7'; // required: replace example with your forum shortname
		var disqus_identifier = '2015/03/cd-pipeline-with-jenkins.html';
    	var disqus_title = "Building a CD pipeline with Jenkins";
    	var disqus_url = 'https://willis7.github.io/blog2015/03/cd-pipeline-with-jenkins.html';

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	<!-- **** END **** -->

	<!-- **** ANALYTICS **** -->
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-60966243-1', 'auto');
	  ga('send', 'pageview');

	</script>
	<!-- **** END **** -->

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2014 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.3.0</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../js/jquery-1.11.1.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/prettify.js"></script>

    <!-- **** DISQUS **** -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'willis7'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- **** END **** -->
    
  </body>
</html>